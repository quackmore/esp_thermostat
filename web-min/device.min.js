function update_page(){update_device_info(),update_wifi(),update_cron(),setTimeout((function(){update_mdns(),update_datetime(),update_diag()}),250),setTimeout((function(){periodically_update_datetime(),update_ota()}),500)}function esp_get_info(e){$.ajax({type:"GET",url:esp8266.url+"/api/info",dataType:"json",crossDomain:esp8266.cors,timeout:2e3,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_device_info(){esp_get_info((function(e){$("#app_name").val(e.app_name),$("#app_version").val(e.app_version),$("#dev_name").val(e.device_name),$("#espbot_version").val(e.espbot_version),$("#api_version").val(e.api_version),$("#library_version").val(e.library_version),$("#chip_id").val(e.chip_id),$("#sdk_version").val(e.sdk_version),$("#boot_version").val(e.boot_version),$("#info_buttons").hasClass("d-none")&&$("#dev_name").prop("disabled",!0)}))}function esp_wifi_info(e){$.ajax({type:"GET",url:esp8266.url+"/api/wifi",dataType:"json",crossDomain:esp8266.cors,timeout:2e3,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_wifi(){esp_wifi_info((function(e){$("#wifi_working_as").val(e.op_mode),$("#wifi_ssid_label").text((function(){return"STATION"===e.op_mode?"Connected to":"SSID"})),$("#wifi_ssid").val(e.SSID),$("#wifi_ip").val(e.ip_address)}))}function esp_wifi_scan(e){$.ajax({type:"GET",url:esp8266.url+"/api/wifi/scan",dataType:"json",crossDomain:esp8266.cors,timeout:1e4,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_wifi_aps(){$("#wifi_aps").empty(),$("#wifi_aps").append('<option selected><span class="sr-only">Loading...</span></option>'),esp_wifi_scan((function(e){$("#wifi_aps").empty();for(var a=0;a<e.AP_SSIDs.length;a++)$("#wifi_ssid").val()===e.AP_SSIDs[a]?$("#wifi_aps").append("<option value='"+a+"' selected>"+e.AP_SSIDs[a]+"</option>"):$("#wifi_aps").append("<option value='"+a+"'>"+e.AP_SSIDs[a]+"</option>")}))}function esp_get_cron(e){$.ajax({type:"GET",url:esp8266.url+"/api/cron",dataType:"json",crossDomain:esp8266.cors,timeout:2e3,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_cron(){esp_get_cron((function(e){$("#cron_status").val(e.cron_enabled),$("#cron_buttons").hasClass("d-none")&&$("#cron_status").prop("disabled",!0)}))}function esp_get_mdns(e){$.ajax({type:"GET",url:esp8266.url+"/api/mdns",dataType:"json",crossDomain:esp8266.cors,timeout:2e3,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_mdns(){esp_get_mdns((function(e){$("#mdns_status").val(e.mdns_enabled),$("#mdns_buttons").hasClass("d-none")&&$("#mdns_status").prop("disabled",!0)}))}function esp_get_datetime(e){$.ajax({type:"GET",url:esp8266.url+"/api/timedate",dataType:"json",crossDomain:esp8266.cors,timeout:2e3,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_datetime(){esp_get_datetime((function(e){$("#datetime_date").val(e.date),$("#datetime_sntp").val(e.sntp_enabled),$("#datetime_timezone").val((function(){return e.timezone>0?"+"+e.timezone:e.timezone})),$("#datetime_buttons").hasClass("d-none")&&($("#datetime_sntp").prop("disabled",!0),$("#datetime_timezone").prop("disabled",!0)),1==$("#datetime_sntp").val()?$("#datetime_set").prop("disabled",!0):$("#datetime_set").prop("disabled",!1)}))}$(document).ready((function(){setTimeout((function(){$("#awaiting").modal("hide")}),1e3),update_page()})),$("#info_edit").on("click",(function(){$("#info_buttons").hasClass("d-none")?($("#info_buttons").removeClass("d-none"),$("#dev_name").removeClass("border-0"),$("#dev_name").prop("disabled",!1)):($("#info_buttons").addClass("d-none"),$("#dev_name").addClass("border-0"),$("#dev_name").prop("disabled",!0))})),$("#info_refresh").on("click",(function(){update_device_info()})),$("#info_save").on("click",(function(e){$.ajax({type:"POST",url:esp8266.url+"/api/deviceName",dataType:"json",contentType:"application/json",data:JSON.stringify({device_name:$("#dev_name").val()}),crossDomain:esp8266.cors,timeout:2e3,success:function(){alert("Device name saved."),update_device_info()},error:function(e,a,t){ajax_error(e,a,t)}})})),$("#wifi_edit").on("click",(function(){$("#wifi_buttons").hasClass("d-none")?($("#wifi_buttons").removeClass("d-none"),update_wifi_aps()):$("#wifi_buttons").addClass("d-none")})),$("#wifi_refresh").on("click",(function(e){update_wifi_aps()})),$("#wifi_connect").on("click",(function(e){$.ajax({type:"POST",url:esp8266.url+"/api/wifi/cfg",dataType:"json",contentType:"application/json",data:JSON.stringify({station_ssid:$("#wifi_aps option:selected").text(),station_pwd:$("#wifi_pwd").val()}),crossDomain:esp8266.cors,timeout:2e3,success:function(e){alert("Conneting to AP "+$("#wifi_aps option:selected").text()+" ...")},error:function(e,a,t){ajax_error(e,a,t)}})})),$("#cron_edit").on("click",(function(){$("#cron_buttons").hasClass("d-none")?($("#cron_buttons").removeClass("d-none"),$("#cron_status").removeClass("border-0"),$("#cron_status").prop("disabled",!1)):($("#cron_buttons").addClass("d-none"),$("#cron_status").addClass("border-0"),$("#cron_status").prop("disabled",!0))})),$("#cron_refresh").on("click",(function(){update_cron()})),$("#cron_save").on("click",(function(){$.ajax({type:"POST",url:esp8266.url+"/api/cron",dataType:"json",contentType:"application/json",data:JSON.stringify({cron_enabled:Number($("#cron_status").val())}),crossDomain:esp8266.cors,timeout:2e3,success:function(){alert("Cron status saved."),update_cron()},error:function(e,a,t){ajax_error(e,a,t)}})})),$("#mdns_edit").on("click",(function(){$("#mdns_buttons").hasClass("d-none")?($("#mdns_buttons").removeClass("d-none"),$("#mdns_status").removeClass("border-0"),$("#mdns_status").prop("disabled",!1)):($("#mdns_buttons").addClass("d-none"),$("#mdns_status").addClass("border-0"),$("#mdns_status").prop("disabled",!0))})),$("#mdns_refresh").on("click",(function(){update_mdns()})),$("#mdns_save").on("click",(function(){$.ajax({type:"POST",url:esp8266.url+"/api/mdns",dataType:"json",contentType:"application/json",data:JSON.stringify({mdns_enabled:Number($("#mdns_status").val())}),crossDomain:esp8266.cors,timeout:2e3,success:function(){alert("mDNS status saved."),update_mdns()},error:function(e,a,t){ajax_error(e,a,t)}})}));var device_running=1;function periodically_update_datetime(){device_running&&esp_get_datetime((function(e){$("#datetime_date").val(e.date)})),setTimeout((function(){periodically_update_datetime()}),1e4)}function esp_get_ota(e){$.ajax({type:"GET",url:esp8266.url+"/api/ota/cfg",dataType:"json",crossDomain:esp8266.cors,timeout:2e3,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_ota(){esp_get_ota((function(e){$("#ota_host").val(e.host),$("#ota_port").val(e.port),$("#ota_path").val(e.path),$("#ota_check_version").val(e.check_version),$("#ota_buttons").hasClass("d-none")&&($("#ota_host").prop("disabled",!0),$("#ota_port").prop("disabled",!0),$("#ota_path").prop("disabled",!0),$("#ota_check_version").prop("disabled",!0)),""===$("#ota_host").val()||0==$("#ota_port").val()||""===$("#ota_path").val()?$("#ota_start").prop("disabled",!0):$("#ota_start").prop("disabled",!1)}))}function esp_get_diag(e){$.ajax({type:"GET",url:esp8266.url+"/api/diagnostic/cfg",dataType:"json",crossDomain:esp8266.cors,timeout:2e3,success:function(a){e(a)},error:function(e,a,t){ajax_error(e,a,t)}})}function update_diag(){esp_get_diag((function(e){$("#diag_led").val(e.diag_led_mask),$("#diag_serial").val(e.serial_log_mask),$("#diag_bitrate").val(e.uart_0_bitrate),$("#diag_sdk_print").val(e.sdk_print_enabled),$("#diag_buttons").hasClass("d-none")&&($("#diag_led").prop("disabled",!0),$("#diag_serial").prop("disabled",!0),$("#diag_bitrate").prop("disabled",!0),$("#diag_sdk_print").prop("disabled",!0))}))}$("#datetime_edit").on("click",(function(){$("#datetime_buttons").hasClass("d-none")?($("#datetime_buttons").removeClass("d-none"),$("#datetime_sntp").removeClass("border-0"),$("#datetime_sntp").prop("disabled",!1),$("#datetime_timezone").removeClass("border-0"),$("#datetime_timezone").prop("disabled",!1)):($("#datetime_buttons").addClass("d-none"),$("#datetime_sntp").addClass("border-0"),$("#datetime_sntp").prop("disabled",!0),$("#datetime_timezone").addClass("border-0"),$("#datetime_timezone").prop("disabled",!0))})),$("#datetime_refresh").on("click",(function(){update_datetime()})),$("#datetime_save").on("click",(function(){$.ajax({type:"POST",url:esp8266.url+"/api/timedate/cfg",dataType:"json",contentType:"application/json",data:JSON.stringify({sntp_enabled:Number($("#datetime_sntp").val()),timezone:Number($("#datetime_timezone").val())}),crossDomain:esp8266.cors,timeout:2e3,success:function(){alert("Time & Date settings saved."),update_datetime()},error:function(e,a,t){ajax_error(e,a,t)}})})),$("#datetime_set").on("click",(function(){var e=new Date,a=Math.floor(e.getTime()/1e3);$.ajax({type:"POST",url:esp8266.url+"/api/timedate",dataType:"json",contentType:"application/json",data:JSON.stringify({timestamp:a}),crossDomain:esp8266.cors,timeout:2e3,success:function(){alert("Device Time & Date set to "+e.toUTCString()),update_datetime()},error:function(e,a,t){ajax_error(e,a,t)}})})),$("#ota_edit").on("click",(function(){$("#ota_buttons").hasClass("d-none")?($("#ota_buttons").removeClass("d-none"),$("#ota_host").removeClass("border-0"),$("#ota_host").prop("disabled",!1),$("#ota_port").removeClass("border-0"),$("#ota_port").prop("disabled",!1),$("#ota_path").removeClass("border-0"),$("#ota_path").prop("disabled",!1),$("#ota_check_version").removeClass("border-0"),$("#ota_check_version").prop("disabled",!1)):($("#ota_buttons").addClass("d-none"),$("#ota_host").addClass("border-0"),$("#ota_host").prop("disabled",!0),$("#ota_port").addClass("border-0"),$("#ota_port").prop("disabled",!0),$("#ota_path").addClass("border-0"),$("#ota_path").prop("disabled",!0),$("#ota_check_version").addClass("border-0"),$("#ota_check_version").prop("disabled",!0))})),$("#ota_host").change((function(){$("#ota_start").prop("disabled",!0)})),$("#ota_port").change((function(){$("#ota_start").prop("disabled",!0)})),$("#ota_path").change((function(){$("#ota_start").prop("disabled",!0)})),$("#ota_check_version").change((function(){$("#ota_start").prop("disabled",!0)})),$("#ota_refresh").on("click",(function(){update_ota()})),$("#ota_save").on("click",(function(){$.ajax({type:"POST",url:esp8266.url+"/api/ota/cfg",dataType:"json",contentType:"application/json",data:JSON.stringify({host:$("#ota_host").val(),port:Number($("#ota_port").val()),path:$("#ota_path").val(),check_version:Number($("#ota_check_version").val()),reboot_on_completion:1}),crossDomain:esp8266.cors,timeout:2e3,success:function(){alert("OTA settings saved."),update_ota()},error:function(e,a,t){ajax_error(e,a,t)}})})),$("#ota_start").on("click",(function(){$("#awaiting").modal("show"),device_running=0,$.ajax({type:"POST",url:esp8266.url+"/api/ota",dataType:"json",crossDomain:esp8266.cors,timeout:18e3,success:function(e){setTimeout((function(){$("#awaiting").modal("hide")}),1e3),alert(""+e.msg),device_running=e.msg.includes("ebooting")?0:1},error:function(e,a,t){setTimeout((function(){$("#awaiting").modal("hide")}),1e3),ajax_error(e,a,t),device_running=1}})})),$("#diag_edit").on("click",(function(){$("#diag_buttons").hasClass("d-none")?($("#diag_buttons").removeClass("d-none"),$("#diag_led").removeClass("border-0"),$("#diag_led").prop("disabled",!1),$("#diag_serial").removeClass("border-0"),$("#diag_serial").prop("disabled",!1),$("#diag_bitrate").removeClass("border-0"),$("#diag_bitrate").prop("disabled",!1),$("#diag_sdk_print").removeClass("border-0"),$("#diag_sdk_print").prop("disabled",!1)):($("#diag_buttons").addClass("d-none"),$("#diag_led").addClass("border-0"),$("#diag_led").prop("disabled",!0),$("#diag_serial").addClass("border-0"),$("#diag_serial").prop("disabled",!0),$("#diag_bitrate").addClass("border-0"),$("#diag_bitrate").prop("disabled",!0),$("#diag_sdk_print").addClass("border-0"),$("#diag_sdk_print").prop("disabled",!0))})),$("#diag_refresh").on("click",(function(){update_diag()})),$("#diag_save").on("click",(function(){$.ajax({type:"POST",url:esp8266.url+"/api/diagnostic/cfg",dataType:"json",contentType:"application/json",data:JSON.stringify({diag_led_mask:Number($("#diag_led").val()),serial_log_mask:Number($("#diag_serial").val()),uart_0_bitrate:Number($("#diag_bitrate").val()),sdk_print_enabled:Number($("#diag_sdk_print").val())}),crossDomain:esp8266.cors,timeout:2e3,success:function(){alert("Diagnostic settings saved."),update_diag()},error:function(e,a,t){ajax_error(e,a,t)}})}));